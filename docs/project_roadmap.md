# A股全市场资金流向分析系统 - 项目文档

## 1. 项目目标
构建一个基于 Python 的量化分析工具，覆盖 **上海 (SSE)** 和 **深圳 (SZSE)** 证券交易所的全市场股票。核心逻辑是利用**融资融券（杠杆资金）**和**北向资金（外资）**的流向数据，结合趋势追踪与基本面过滤，辅助发现中短线交易机会。

## 2. 核心架构设计
采用 **"本地数据仓库 + 每日增量更新 + 交互式仪表盘"** 的架构。

*   **开发语言:** Python 3.x
*   **核心库:** `AkShare` (数据源), `Pandas` (数据处理), `SQLite` (本地存储), `Streamlit` (可视化前端).
*   **工作流:**
    1.  **ETL (数据工厂):** `data_loader.py` 负责每日收盘后的全量/增量数据同步。
    2.  **Analysis (分析大脑):** `analyzer.py` 负责计算资金强度、趋势指标、基本面过滤和大盘情绪。
    3.  **Visualization (展示终端):** `dashboard.py` 提供 Web 界面进行选股和深度分析。

## 3. 数据指标体系

### A. 基础信息 (Fundamentals)
*   **股票代码 & 名称**
*   **所属板块 (Sector):** 沪市主板, 科创板, 深市主板, 创业板。
*   **所属行业 (Industry):** 具体业务分类（如半导体、白酒）。
*   **总市值 (Total MV):** 衡量公司体量，用于过滤微盘股。
*   **市盈率 (PE-TTM):** 衡量估值与盈利能力，用于过滤亏损股。

### B. 资金流向 (Capital Flows)
*   **融资余额:** 市场存量杠杆资金（内资激进派）。
*   **融资净买入:** 当日主力加仓强度。
*   **融资异动 (Surge):** (融资净买入 / 流通市值) > 0.3%，捕捉主力潜伏。
*   **北向资金持仓:** (沪深港通) 外资持股总市值。
*   **北向资金流入:** 外资持仓市值的每日变化。

### C. 趋势与情绪 (Trend & Sentiment)
*   **生命线:** 20日均线 (MA20)，作为多空分界线。
*   **大盘情绪:** 全市场上涨家数占比，判断市场冷暖（狂热/冰点）。

## 4. 信号系统 (Signal Logic)

### 🟢 进攻信号
*   **强力买入 (Strong Buy):** 融资抢筹 + 北向扫货 + 趋势向上 (MA20之上)。
*   **关注-加速 (Watch - Surge):** 融资大幅净买入 + 放量。
*   **关注-反弹 (Watch - Rebound):** 资金流入但趋势尚在左侧 (MA20之下)。

### 🔴 防守信号
*   **止损离场 (Stop Loss):** 跌破 MA20 + 资金流出。
*   **高位减仓 (Take Profit):** 融资占比过高 + 乖离率过大。

### ⚫ 过滤信号 (Blacklist)
*   **黑名单:** ST 股、市值 < 20亿、严重亏损股（自动屏蔽）。

## 5. 开发计划与进度 (Roadmap)

### 第一阶段：基础建设 ✅ (已完成)
*   [x] 数据库设计 (SQLite)
*   [x] 沪市股票列表与行情抓取
*   [x] 融资融券数据入库

### 第二阶段：全市场扩容 ✅ (已完成)
*   [x] 支持深圳市场 (00/30 开头股票)
*   [x] 支持深市两融数据
*   [x] 支持沪深港通 (北向) 全市场数据

### 第三阶段：分析引擎与可视化 ✅ (已完成)
*   [x] `analyzer.py` 信号算法实现
*   [x] `dashboard.py` Streamlit 交互界面
*   [x] 资金热力榜与个股深度 K 线图

### 第四阶段：科学化增强 ✅ (已完成)
*   [x] **基本面风控:** 引入 PE、总市值数据，剔除垃圾股。
*   [x] **大盘环境监控:** 增加全市场涨跌比，计算市场温度。
*   [x] **行业板块:** 增加行业分类映射。
*   [x] **实时行情增强:** 盘中实时抓取现价、量比、今开幅。
*   [x] **模拟交易系统:** 建立独立的账户、持仓、成交记录表，支持 10w 初始资金模拟实战。

### 第五阶段：未来展望 (To-Do)
*   [ ] 历史策略回测系统 (自动化跑分)。
*   [ ] 组合调仓建议引擎。

## 6. 更新日志 (Change Log)
*   **2026-01-04:** 
    *   完成**全市场覆盖**，支持沪深 5000+ 股票。
    *   新增 **防雷机制** 与 **大盘情绪温度计**。
    *   **实时行情**: Dashboard 接入秒级行情，新增今开幅、量比等指标。
    *   **模拟实战**: 上线模拟炒股模块，支持持仓盈亏实时计算。
    *   精简项目结构，优化文件夹内容。